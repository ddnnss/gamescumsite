{% extends 'basic.html' %}
{% load static %}


{% block content %}
     <!-- Page Heading
		================================================== -->
        <div class="page-heading">
            <div class="container">
                <div class="row">
                    <div class="col-md-10 offset-md-1">
                        <h1 class="page-heading__title font_scum">ТВОЙ <span class="highlight">ПРОфИЛЬ</span></h1>
                        <ol class="page-heading__breadcrumb breadcrumb">
                            <li class="breadcrumb-item"><a href="/">Главная</a></li>
                            <li class="breadcrumb-item active" aria-current="page">ПРОФИЛЬ</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        <!-- Page Heading / End -->
        <!-- Content
		================================================== -->

    <div class="container">
    <div class="row">
        <!-- Content -->
        <div class="content col-md-8">
            <!-- Staff Member -->
            <div class="card card--clean alc-staff">
                <div class="card__header card__header--has-btn">
                    <h4>Персональная информация</h4></div>

                 <div class="card__content">
                                <div class="card mb-0">
                                    <div class="card__content">
                                        <div class="row">
                                            <div class="col-md-12">
                                        <div class="widget card widget--sidebar widget-player widget-player--alt">
                                                    <div class="widget__content card__content">
                                                        <div class="widget-player__team-logo"><img src="{{ player.avatarfull }}" alt=""></div>
                                                        <figure class="widget-player__photo"><img src="{{ player.avatarfull }}" alt=""></figure>
                                                        <header class="widget-player__header clearfix">
                                                            <div class="widget-player__number"></div>
                                                            <h4 class="widget-player__name"><span class="widget-player__last-name">{{ player.personaname }}</span></h4></header>
                                                        <div class="widget-player__content">
                                                            <div class="widget-player__content-inner">
                                                                <div class="widget-player__stat widget-player__assists">
                                                                    <h6 class="widget-player__stat-label">Убийств</h6>
                                                                    <div class="widget-player__stat-number">{{ player.kills }}</div>

                                                                </div>
                                                                <div class="widget-player__stat widget-player__steals">
                                                                    <h6 class="widget-player__stat-label">Смертей</h6>
                                                                    <div class="widget-player__stat-number">{{ player.deaths }}</div>

                                                                </div>

                                                                  <div class="widget-player__stat widget-player__blocks">
                                                                    <h6 class="widget-player__stat-label">Баланс</h6>
                                                                      <div class="widget-player__stat-number"><span id="player_wallet">{{ player.wallet }}</span> RC</div>

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <footer class="widget-player__footer"><span class="widget-player__footer-txt">Дата регистрации: {{ player.date_joined }}</span></footer>
                                                    </div>
                                                </div>
                        </div>

                                            </div>
                                            <div class="col-md-12">
                                                <div class="alc-staff-inner">


                                                    <dl class="alc-staff-details">
                                                    <dt class="alc-staff-details__label">Рейтинг :</dt><dd class="alc-staff-details__value">{{ player.rating| }}</dd>
                                                        <dt class="alc-staff-details__label">Discord ID:</dt><dd class="alc-staff-details__value">{{ player.discord_id }}</dd>
                                                        <dt class="alc-staff-details__label">Steam профиль:</dt><dd class="alc-staff-details__value"><a href="{{ player.profileurl }}" target="_blank"> ССЫЛКА</a></dd>
                                                        <dt class="alc-staff-details__label">Звание:</dt><dd class="alc-staff-details__value">{{ player.rank }}</dd>
                                                        <dt class="alc-staff-details__label">VAC-баны:</dt><dd class="alc-staff-details__value">{{ player.kills }}</dd>
                                                        <dt class="alc-staff-details__label">Время в игре (часов):</dt><dd class="alc-staff-details__value">{{ player_play_time }}</dd>

                                                        {% if squad_info %}

                                                            <dt class="alc-staff-details__label">Отряд:</dt><dd class="alc-staff-details__value"> {{ squad_info.name }}</dd>
                                                            <dt class="alc-staff-details__label">Уровень отряда:</dt><dd class="alc-staff-details__value"> {{ squad_info.level }}</dd>
                                                            <dt class="alc-staff-details__label">Баланс отряда:</dt><dd class="alc-staff-details__value"> {{ squad_info.balance }} RC</dd>

                                                            <form style="padding-bottom: 15px;" action="{% url 'add_to_balance' %}" class="form-inline" method="post">
                                                             {% csrf_token %}

                                                                <input  type="text" pattern="[0-9]*" name="rc_amount" class="form-control" required="required" id="amount" placeholder="Кол-во RC">
                                                                    <input type='hidden' id="cur_bal" value="{{ player.wallet }}">
                                                                  <input type='hidden' name="squad_id" value="{{ squad_info.id }}">

                                                              <button style="margin-left: 10px;" type="submit" id="add_to_bal_btn" class="btn  btn-outline-danger btn-sm ">Пополнить баланс отряда</button>
                                                            </form>
                                                            <br>
                                                            <dt class="alc-staff-details__label">Владение секторами:</dt><dd class="alc-staff-details__value">
                                                        {% for sector in squad_sectors %}
                                                            {{ sector.name }}
                                                        {% endfor %}


                                                             </dd>

                                                        {% else %}
                                                            <dt class="alc-staff-details__label">Отряд:</dt><dd class="alc-staff-details__value">нет</dd>
                                                        {% endif %}



                                                    </dl>
                                                    <div class="alc-staff-excerpt">
                                                          <form action="" method="post">
                                                            {% csrf_token %}
                                                           <div class="form-group">
                                                            <label for="player_info">Информация о себе <span class="required">*</span></label>

                                                               <textarea id="player_info" name="{{ form.info.name }}"  class="form-control">{{ request.user.info }}</textarea>
                                                         </div>

                                                            <button type="submit" class="btn  btn-outline-danger btn-sm ">Обновить данные профиля</button>
                                                        </form>
                                                    </div>
                                                    <!-- Details / End -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

            </div>
            <!-- Staff Member / End -->
            <!-- Lates News -->
        {% if not squad_info %}
             <div class="card card--clean alc-staff">
                <div class="card__header card__header--has-btn">
                    <h4>Создание отряда</h4></div>
                 <div class="card__content">
                                <div class="card mb-0">
                                    <div class="card__content">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="alc-staff-inner">


                                               <form enctype="multipart/form-data" action="{% url 'create_squad' %}" method="post">
                                                    {% csrf_token %}

                                                      <div class="form-group">
                                                    <label for="contact-form-name">Название отряда <span class="required">*</span></label>
                                                       {{ squad_form.name.errors }}
                                                    <input type="text" name="{{ squad_form.name.name }}" value="" required="required"  class="form-control" placeholder="Тру-нагибаторы">
                                                        </div>
                                                         <div class="form-group">
                                                            <label for="contact-form-name">Автар отряда <span class="required">*</span></label>
                                                              {{ squad_form.avatar.errors }}

                                                            <input type="file" name="{{ squad_form.avatar.name }}"  required="required" class="form-control" >
                                                        </div>
                                                           <div class="form-group">
                                                                <label for="squad_form_wear">Форма отряда</label>
                                                                <select  name="{{  squad_form.wear.name }}" id="squad_form_wear" class="form-control ">
                                                                    {% for wear in squad_wear %}
                                                                    <option style="color: #000" value="{{ wear.id }}">{{ wear.name }}</option>
                                                                    {% endfor %}

                                                                </select>
                                                            </div>


                                                       <div class="form-group">
                                                        <label for="squad_info">Дополнительная информация об отряде </label>

                                                           <textarea id="squad_info" name="{{ squad_form.info.name }}"  class="form-control">Дополнительных сведений об отряде не предоставлено.</textarea>
                                                     </div>
                                                         <input type="hidden" name="{{ squad_form.leader.name }}" value="{{ request.user.id }}">

                                                        <button type="submit" id="create_squad_btn" class="btn btn-primary-inverse btn-lg ">Создать отряд.</button>
                                                    </form>

                                                    <!-- Details / End -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

            </div>
             </div>
         {% endif %}

          {% if player.is_squad_leader %}
           <div class="card card--clean alc-staff">
                <div class="card__header card__header--has-btn">
                    <h4>Управление отрядом</h4>

                    <a style="margin-left: 5px;" href="{% url 'delete_squad' %}" class="btn btn-danger btn-outline btn-xs card-header__button" onclick="return confirm('Точно удалить? Вся информация будет безвозвратно утеряна!!!');">УДАЛИТЬ ОТРЯД</a>
                    <a href="{% url 'level_up' %}" id="level_up_btn" class="btn btn-warning btn-outline btn-xs card-header__button">ПОВЫСИТЬ УРОВЕНЬ ОТРЯДА</a>
                </div>
                               <div class="card__content">
                                <div class="card mb-0">
                                    <div class="card__content">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="alc-staff-inner">
  <div>


      <dl class="alc-staff-details">
          <dt class="alc-staff-details__label">Баланс отряда :</dt><dd class="alc-staff-details__value"><span id="squad_balance">{{ squad_info.balance }}</span> RC</dd>
          <dt class="alc-staff-details__label">Текущий уровень отряда :</dt><dd class="alc-staff-details__value">{{ squad_info.level }}
          <dt class="alc-staff-details__label">Стоимость перехода на следуюший уровень :</dt>
          <dd class="alc-staff-details__value">
              {% if squad_info.level ==  1 %}
                 <span id="level_up_cost">1000</span> RC
               {% elif squad_info.level == 2 %}
                   <span id="level_up_cost">3000</span> RC
               {% elif squad_info.level == 3 %}
                  <span id="level_up_cost">5000</span> RC
               {% elif squad_info.level == 4 %}
                  <span id="level_up_cost">10000</span> RC
               {% elif squad_info.level == 5 %}
                  <span id="level_up_cost">15000</span> RC
              {% endif %}


          </dd>



      </dl>
  </div>

                                                    <hr>

                                               <form enctype="multipart/form-data" action="{% url 'create_squad' %}" method="post">
                                                        {% csrf_token %}

                                                                 <div class="form-group">
                                                                  <label for="contact-form-name">Название отряда <span class="required">*</span></label>
                                                         
                                                                     <input type="text" name="{{ squad_form.name.name }}" value="{{ squad_info.name }}" required="required"  class="form-control" placeholder="Тру-нагибаторы">
                                                                   </div>
                                                                    <div class="form-group">
                                                                     <label class="checkbox checkbox-inline">
                                                                    {{ squad_form.recruting }} Набор открыт?
                                                                         <span class="checkbox-indicator"></span>
                                                                     </label>
                                                                    </div>

                                                                       <div class="form-group form-group--upload">
                                                                            <div class="form-group__avatar"><img src="{{ squad_info.avatar.url }}" alt="">
                                                                                <div class="form-group__label">
                                                                                    <h6>Логотип отряда</h6><span>Желательно прозрачный png</span></div>
                                                                            </div>
                                                                            <div class="form-group__upload">
                                                                                <label class="btn btn-default btn-xs btn-file">Загрузить...
                                                                                  <input type="file" name="{{ squad_form.avatar.name }}"   style="display: none;" >
                                                                                </label>
                                                                            </div>
                                                                        </div>

                                                                   <div class="form-group">
                                                                    <label for="squad_info">Дополнительная информация об отряде </label>

                                                                       <textarea id="squad_info" name="{{ squad_form.info.name }}"  class="form-control">{{ squad_info.info }}</textarea>
                                                                 </div>
                                                                 <input type="hidden" name="update" value="1">
                                                                    <input type="hidden" name="{{ squad_form.wear.name  }}" value="{{ squad_info.wear.id }}">

                                                        <button type="submit" class="btn  btn-outline-danger btn-sm ">Изменить отряд</button>
                                                    </form>

                                                    <!-- Details / End -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

            </div>
             </div>
          {% endif %}
        </div>
        <!-- Content / End -->
        <!-- Sidebar -->
        <div class="sidebar col-md-4">

            <!-- Widget: Player Newslog -->
            <aside class="widget card widget--sidebar widget-newslog">
                <div class="widget__title card__header">
                    <h4>Сообшения</h4></div>
                <div class="widget__content card__content">
                    <ul class="newslog">
                        {% if pm%}
                            {% for message in pm %}
                        <li class="newslog__item newslog__item--join">
                            <div class="newslog__item-inner">
                                <div class="newslog__content"><img style="margin-right: 10px;border-radius: 10px;" src="{{ message.from_player_avatar }}"/> <strong>{{ message.text }}</strong> <a class="btn btn-danger btn-outline btn-xs del_btn" href="{% url 'del_message' %}?m_id={{message.id  }}">Х</a></div>
                                <div class="newslog__date">От: <a  href="{% url 'profile' message.from_player_name_slug %}">{{ message.from_player_name }}</a> </div>
                            </div>
                        </li>

                    {% endfor %}
                    {% else %}
                           <li class="newslog__item newslog__item--exit">
                            <div class="newslog__item-inner">
                                <div class="newslog__content"><strong>Личных сообщений нет</strong> </div>

                            </div>
                        </li>
                    {% endif %}

                    </ul>
                </div>
            </aside>
            {% if squad_info %}
             <aside class="widget card widget--sidebar widget-newslog">
                <div class="widget__title card__header">
                    <h4>Состав отряда</h4></div>
                <div class="widget__content card__content">
                    <ul class="newslog">
                        {% for playerr in squad_members %}
                            {% if playerr.player.is_squad_leader%}
                                <li class="newslog__item newslog__item--award">
                                {% else %}
                        <li class="newslog__item newslog__item--injury">
                        {% endif %}
                            <div class="newslog__item-inner">
                                <div class="newslog__content"><strong><a  href="{% url 'profile' playerr.player.nickname %}">{{ playerr.player.personaname }}</a></strong>

                                    {% if player.is_squad_leader%}
                                        {% if playerr.player.id != player.id %}

                                       <a class="btn btn-danger btn-outline btn-xs del_btn" href="{% url 'kick_player' playerr.player.nickname %}">Х</a>
                                         {% endif %}
                                    {% endif %}
                                </div>
                                <div class="newslog__date">Взносов в общак отряда : {{ playerr.income }} RC</div>
                            </div>
                        </li>
                    {% endfor %}
                    </ul>
                </div>
            </aside>
         {% endif %}
        {% if player.is_squad_leader %}
            <aside class="widget card widget--sidebar widget-newslog">
                <div class="widget__title card__header">
                    <h4>Заявки на вступление</h4></div>
                <div class="widget__content card__content">
                    <ul class="newslog">
                    {% if squad_join_requests%}
                            {% for rr in squad_join_requests %}
                        <li class="newslog__item newslog__item--join">
                            <div class="newslog__item-inner">
                                <div class="newslog__content"><img style="margin-right: 10px;border-radius: 10px;" src="{{ rr.player.avatar }}"/> <strong><a  href="{% url 'profile' rr.player.nickname %}">{{ rr.player.personaname }}</a></strong> </div>
                                <div class="newslog__date"><a class="btn btn-success btn-outline btn-xs" href="{% url 'confirm_request' %}?name={{ rr.player.nickname }}">ПРИНЯТЬ</a> <a class="btn btn-danger btn-outline btn-xs" href="{% url 'reject_request' %}?r_id={{ rr.id }}">ОТКЛОНИТЬ</a></div>

                            </div>
                        </li>

                    {% endfor %}
                    {% else %}
                           <li class="newslog__item newslog__item--exit">
                            <div class="newslog__item-inner">
                                <div class="newslog__content"><strong>Заявок в отряд нет</strong> </div>

                            </div>
                        </li>
                    {% endif %}
                    </ul>
                </div>
            </aside>


            {% endif %}
            <!-- Widget: Player Newslog / End -->
        </div>
        <!-- Sidebar / End -->
    </div>
    <div style="background-image: url(/static/images/map.png);width: 900px; height: 900px;background-size: contain;">

        <table style="
        table-layout: fixed;
        width: 900px;
    height: 900px;">
            <tr style="    height: 25%;">
                <td>sdf</td>
                 <td>sdf</td>
                 <td>sdf</td>
                 <td>sdf</td>
            </tr>
             <tr style="    height: 25%;">
                <td>sdf</td>
                 <td>sdf</td>
                 <td>sdf</td>
                 <td>sdf</td>
            </tr>
             <tr style="    height: 25%;">
                <td>sdf</td>
                 <td>sdf</td>
                 <td>sdf</td>
                 <td>sdf</td>
            </tr>
             <tr style="    height: 25%;">
                 {% for sect in sectors_a %}
                <td style="
                     text-align: center;
                      color: #fff;
                     font-weight: bold;
                        {% if sect.squad.name %}
                            background-color: #ff7e1f96;
                            color: #fff;
                        {% endif %}
">
                    {{ sect.name }}<br>
                    {% if sect.squad.name %}
                        Владелец с {{ sect.own.date }}<br>
                        <img width="40px" src="{{ squad_info.avatar.url }}" alt=""><br>
                         {{ sect.squad.name }}
                        {% else %}
                        <div>
                         СВОБОДНО<br>
                        Доход : {{ sect.income }}<br>
                        Цена : {{ sect.price }}<br>
                        <a href="{% url 'buy_sector' %}?s={{ sect.id }}" class="btn btn-danger btn-xs">КУПИТЬ</a>
                        </div>

                        {% endif %}
                </td>

                 {% endfor %}
            </tr>
        </table>

    </div>
</div>





        <!-- Content / End -->
{% endblock %}